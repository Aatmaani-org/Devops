pipeline {
    agent any

    stages {
        stage ('clean everything and clone ') {
            steps{
                sh ''' rm -rf *
                git clone https://github.com/Aatmaani-org/Devops.git '''
	    }
        }
        stage ('mkdir & clone prod') {
	    steps{
	        sh '''  mkdir workingenv

cd workingenv
                git clone https://github.com/Aatmaani-org/Production.git
		cd /var/lib/jenkins/workspace/sharan/dev/workingenv/Production
		bash  /var/lib/jenkins/workspace/sharan/dev/Devops/Sharan/build.sh'''
            }
	}
        stage ('helm run') {
	    steps{
	        sh '''pwd
                cd /var/lib/jenkins/workspace/sharan/dev/Devops/Sharan
<<<<<<< HEAD
	        helm upgrade --install --atomic --timeout 20s --set image.tag=$commit_id gost nodejs -n dev -f values-dev.yaml'''
#                helm upgrade --install --atomic --timeout 20s --set image.tag=$commit_id warnerbro warnerbros -n dev -f values-dev.yaml
=======
	        helm upgrade --install --atomic --timeout 20s --set image.tag=$latest_id gost nodejs -n dev -f values-dev.yaml'''

>>>>>>> 67071d8d57cafa1a83750283f1c3984872c76a64
	     }
        }
    }

    post { 
      success{
        slackSend channel: 'project-team', message: 'success'
      }
      failure{
        slackSend channel: 'project-team', message: 'job-failed'                                                                                                                                                         }
      }
    }

